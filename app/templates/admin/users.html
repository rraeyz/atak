{% extends "base.html" %}

{% block title %}KullanÄ±cÄ± YÃ¶netimi - ATAK KulÃ¼bÃ¼{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="hero">
    <div class="hero-content">
        <h1>ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi</h1>
        <p>TÃ¼m kullanÄ±cÄ±larÄ± gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin</p>
    </div>
</section>

<!-- Admin Nav -->
<section style="padding: 2rem 0; background: rgba(30, 58, 138, 0.05);">
    <div class="container">
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
            <a href="{{ url_for('admin.index') }}" class="btn btn-secondary">ğŸ“Š Dashboard</a>
            <a href="{{ url_for('admin.users') }}" class="btn btn-primary">ğŸ‘¥ KullanÄ±cÄ±lar</a>
            <a href="{{ url_for('admin.roles') }}" class="btn btn-secondary">ğŸ” Roller</a>
            <a href="{{ url_for('admin.events') }}" class="btn btn-secondary">ğŸ—“ï¸ Etkinlikler</a>
            <a href="{{ url_for('admin.posts') }}" class="btn btn-secondary">ğŸ“ YazÄ±lar</a>
            <a href="{{ url_for('admin.announcements') }}" class="btn btn-secondary">ğŸ“¢ Duyurular</a>
            <a href="{{ url_for('admin.messages') }}" class="btn btn-secondary">ğŸ“§ Mesajlar</a>
            <a href="{{ url_for('admin.settings') }}" class="btn btn-secondary">âš™ï¸ Ayarlar</a>
        </div>
    </div>
</section>

<!-- Users Table -->
<section style="padding: 4rem 0;">
    <div class="container">
        <!-- GeliÅŸmiÅŸ Arama ve Filtreleme -->
        <div class="card" style="margin-bottom: 2rem;">
            <h3 class="card-title">ğŸ” Arama ve Filtreleme</h3>
            <form method="GET" action="{{ url_for('admin.users') }}">
                <div class="grid grid-2" style="gap: 1rem; margin-bottom: 1rem;">
                    <!-- Arama AlanÄ± -->
                    <div class="form-group">
                        <label class="form-label">Arama</label>
                        <input type="text" name="search" class="form-control" 
                               value="{{ request.args.get('search', '') }}" 
                               placeholder="KullanÄ±cÄ± adÄ±, e-posta, isim veya soyisim...">
                    </div>
                    
                    <!-- Arama TÃ¼rÃ¼ -->
                    <div class="form-group">
                        <label class="form-label">Arama AlanÄ±</label>
                        <select name="search_type" class="form-control">
                            <option value="all" {% if request.args.get('search_type', 'all') == 'all' %}selected{% endif %}>
                                TÃ¼m Alanlarda
                            </option>
                            <option value="username" {% if request.args.get('search_type') == 'username' %}selected{% endif %}>
                                KullanÄ±cÄ± AdÄ±
                            </option>
                            <option value="email" {% if request.args.get('search_type') == 'email' %}selected{% endif %}>
                                E-posta
                            </option>
                            <option value="name" {% if request.args.get('search_type') == 'name' %}selected{% endif %}>
                                Ä°sim Soyisim
                            </option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-2" style="gap: 1rem;">
                    <!-- Durum Filtresi -->
                    <div class="form-group">
                        <label class="form-label">Durum</label>
                        <select name="status" class="form-control">
                            <option value="" {% if not request.args.get('status') %}selected{% endif %}>
                                TÃ¼m KullanÄ±cÄ±lar
                            </option>
                            <option value="pending" {% if request.args.get('status') == 'pending' %}selected{% endif %}>
                                â³ Onay Bekleyenler
                            </option>
                            <option value="approved" {% if request.args.get('status') == 'approved' %}selected{% endif %}>
                                âœ“ Onaylananlar
                            </option>
                            <option value="banned" {% if request.args.get('status') == 'banned' %}selected{% endif %}>
                                ğŸš« Banlananlar
                            </option>
                        </select>
                    </div>
                    
                    <!-- Rol Filtresi -->
                    <div class="form-group">
                        <label class="form-label">Rol</label>
                        <select name="role" class="form-control">
                            <option value="" {% if not request.args.get('role') %}selected{% endif %}>
                                TÃ¼m Roller
                            </option>
                            {% for role in all_roles %}
                            <option value="{{ role.id }}" {% if request.args.get('role')|int == role.id %}selected{% endif %}>
                                {{ role.display_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button type="submit" class="btn btn-primary">ğŸ” Ara</button>
                    <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">ğŸ”„ SÄ±fÄ±rla</a>
                </div>
            </form>
        </div>
        
        <!-- HÄ±zlÄ± Filtreler -->
        <div style="margin-bottom: 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <a href="{{ url_for('admin.users') }}" class="btn btn-secondary btn-sm {% if not request.args.get('status') %}active{% endif %}">
                ğŸ“‹ TÃ¼mÃ¼
            </a>
            <a href="{{ url_for('admin.users', status='pending') }}" class="btn btn-secondary btn-sm {% if request.args.get('status') == 'pending' %}active{% endif %}">
                â³ Onay Bekleyenler
            </a>
            <a href="{{ url_for('admin.users', status='approved') }}" class="btn btn-secondary btn-sm {% if request.args.get('status') == 'approved' %}active{% endif %}">
                âœ“ Onaylananlar
            </a>
            <a href="{{ url_for('admin.users', status='banned') }}" class="btn btn-secondary btn-sm {% if request.args.get('status') == 'banned' %}active{% endif %}">
                ğŸš« Banlananlar
            </a>
        </div>
        
        <div class="card">
            <h3 class="card-title">KullanÄ±cÄ± Listesi</h3>
            
            {% if users %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>KullanÄ±cÄ± AdÄ±</th>
                            <th>Ad Soyad</th>
                            <th>E-posta</th>
                            <th>Rol</th>
                            <th>Durum</th>
                            <th>KayÄ±t Tarihi</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>
                                <a href="{{ url_for('admin.user_detail', id=user.id) }}" 
                                   style="color: var(--cosmic-cyan); text-decoration: none;">
                                    {{ user.username }}
                                </a>
                            </td>
                            <td>{{ user.first_name }} {{ user.last_name }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                {% if user.role %}
                                    <span class="badge badge-primary">{{ user.role.name }}</span>
                                {% else %}
                                    <span class="badge badge-secondary">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if not user.is_active %}
                                    <span class="badge badge-danger">ğŸš« BanlandÄ±</span>
                                {% elif user.is_approved %}
                                    <span class="badge badge-success">âœ“ OnaylÄ±</span>
                                {% else %}
                                    <span class="badge badge-warning">â³ Bekliyor</span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%d.%m.%Y') }}</td>
                            <td>
                                <div style="display: flex; gap: 0.25rem;">
                                    <a href="{{ url_for('admin.user_detail', id=user.id) }}" 
                                       class="btn btn-primary btn-sm">ğŸ‘ï¸</a>
                                    {% if not user.is_approved %}
                                        <form method="POST" action="{{ url_for('admin.approve_user', id=user.id) }}" 
                                              style="display: inline;">
                                            <button type="submit" class="btn btn-success btn-sm" 
                                                    title="KullanÄ±cÄ±yÄ± Onayla">âœ“</button>
                                        </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            {% if users.pages > 1 %}
            <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem; flex-wrap: wrap; align-items: center;">
                {% if users.has_prev %}
                    <a href="{{ url_for('admin.users', page=users.prev_num, search=request.args.get('search', ''), search_type=request.args.get('search_type', 'all'), status=request.args.get('status', ''), role=request.args.get('role', '')) }}" 
                       class="btn btn-secondary btn-sm">â† Ã–nceki</a>
                {% endif %}
                
                <span style="padding: 0.5rem 1rem; color: var(--text-gray);">
                    Sayfa {{ users.page }} / {{ users.pages }} (Toplam: {{ users.total }} kullanÄ±cÄ±)
                </span>
                
                {% if users.has_next %}
                    <a href="{{ url_for('admin.users', page=users.next_num, search=request.args.get('search', ''), search_type=request.args.get('search_type', 'all'), status=request.args.get('status', ''), role=request.args.get('role', '')) }}" 
                       class="btn btn-secondary btn-sm">Sonraki â†’</a>
                {% endif %}
            </div>
            {% endif %}
            
            {% else %}
                <p style="color: var(--text-gray); text-align: center;">KullanÄ±cÄ± bulunamadÄ±.</p>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
